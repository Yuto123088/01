# チャットボットメンテナンス標準ワークフロー

**作成日:** 2024-10-02  
**作成者:** [山田]

## 概要
この手順書は、[チャットボットのメンテナンス]を実施するための手順を説明します。

## 使用するツール
- [CloudAI]: 
- [AzureAILanguage]: 

## 汎用手順

### [ログのDL]
1. **[説明]**
   - 取得するデータの範囲を指定してログをExselでDLしてください。  
   **※ [CloudAI](#1)と[AzureAILanguage](#4)でDLの仕方が違うので [個別手順]の[ログのDL]をご覧ください。**
2. **[確認事項]**
   - 指定した範囲でDLされているか確認してください。

### [ログの主な項目]
- **日時**
- **カテゴリ**
- **質問**
- **ID**
- **回答**
- **確信度**
   - 0~100の間で表示されます。
- **JBS判定**
   - 後述する [JBS判定判断基準](#2)もとにGood/badの判定を行います。
- **判定大項目**
   - badが付いたものに対して，後述する [判定大項目判断基準](#3)をもとにbadの切り分けを行います。
- **修正内容**
   - メンテナンス内容をメモします。

<a id="2"></a>
### [JBS判定判断基準]
- **質問が「自由入力」**
   - **質問の意図が理解できる**
      - 質問と回答を比較し、一致している場合→**good**
      - 質問と回答を比較し、一致していない場合→**bad**
   - 質問の意図が不明な場合→**bad**
- **質問が「選択肢」**
   - 質問と回答を比較し、一致している→**good**
   - 質問と回答を比較し、一致していない→**bad**
   
<a id="3"></a>
### [判定大項目判断基準]
- **回答有り_FAQ修正**
   - 対象の質問の意図と結びつく回答が別に存在する場合
   - 対象のFAQに言い回しを追加したり、修正することで意図に答えられるようになる場合
   - 別の回答内容に少し追記修正すれば、意図に答えられるようになる場合
- **回答なし_FAQ作成**
   - 回答有り_FAQ修正に当てはまらないFAQ
- **入力不十分**
   - 単語だけや動詞だけなど判断するうえで情報が不足している場合
   - 長文の質問
   - 誤字脱字
   - 質問の意図が不明な場合

<a id="1"></a>
## CloudAI

### [CloudAIのDL]
1. **teamsから0.1.AIチャットボット＞0.5.使用ファイル・ツール＞Cloud運用使用ツールからをDLしてください。**  
   - 「FAQ学習データ編集用ブック_v13_社内HD.xlsm」
   - 「LogfileOutputTools.xlsm」  
2. **CloudAIのFAQ管理から「アクティブFAQ」のCSVを押して「JBGR_HD_yyymmdd~.zip」をDLしてください。**  
3. **FAQ学習データ編集用ブック_v13_社内HD.xlsmを開き、FAQシートから「FAQMSからのインポート」を押して先ほどDLしたzipファイルを選択してください。** 
4. **FAQシートから「補足回答シート出力」を押します。**  
   - 更新された「補足回答シート」が作成されます。  
5. **CloudAIの学習管理から対象期間を指定して、「検索」を押して「log_yyymmdd~.CSV」をDLしてください。**  
6. **LogfileOutputTools.xlsmを開いて「フィードバック用フォーマット作成」を押して、先ほどDLしたCSVファイルを選択してください。**  
7. **開始日と終了日を入力し、FAQ学習データ編集用ブックを選択してください。**  
   - 「log_yyymmdd(対象期間)社内ヘルプデスク.xlsx」が出力され開くと、「利用者ログシート」と「補足回答シート」が作成されます。
![代替テキスト](/images/your_image.png)

### [CloudAIの機能]
- **FAQ管理**
   - アクティブFAQ（今使われている）
   - スタンバイFAQ（バックアップ）
- **学習管理**
   - 検索と学習
   - FB正解率と学習
- **テスト**
   - 一問一答テスト
   - システム正解率の推移
   - 正解率の測定
   - 正解率の定期測定
   - 閾値と回答変化
- **統計情報**
   - 回答の統計

<a id="4"></a>
## AzureAILanguage

### [AzureAILanguageのDL]
1. **Microsoft Azureポータルを開いてください.**  
2. **Log Analytics ワークスペースから対象のリソースを選択してください。**  
3. **「ログ」を選択して、「クエリ」入力してください。**  
// All QnA Traffic
AzureDiagnostics  
|where ResourceProvider == "MICROSOFT.COGNITIVESERVICES"  
|where OperationName=="CustomQuestionAnswering QueryKnowledgebases"  
//This OperationName is valid for custom question answering enabled resources  
|extend answer_ = tostring(parse_json(properties_s).answer)  
|extend question_ = tostring(parse_json(properties_s).question)  
|extend score_ = tostring(parse_json(properties_s).score)  
|extend kbId_ = tostring(parse_json(properties_s).kbId)  
|extend userId_ = tostring(parse_json(properties_s).userId)  
|project TimeGenerated,question_, answer_, score_, kbId_,userId_  
4. **対象の時間の範囲を指定してください。**
   - 「カスタム」を選択して、カレンダーから開始と終了日時を選び「適用」を押してください 。 
6. **「エクスポート」を押して、「CAV（全ての列）」を選択しログを取得してください。**
![代替テキスト](/images/your_image1.png)

### [AzureAILanguageの機能]
- **FAQの編集**
   - 回答内容の編集
   - インポート・エクスポート
   - 代替質問の設定
   - 遷移先回答（フォローアッププロンプト）
   - タグ付け
   - チャットボットのテスト
   - 同義語の追加・修正
- **利用可能な機能**
   - **言語検出**
      - 1 つ以上のドキュメントを受け取り、それぞれの言語を識別します。
   - **キーフレーズ抽出**
      - 1 つまたは複数のドキュメントのテキストを評価し、そのドキュメントのコンテキストについての要点を特定する。
   - **感情分析**
      - テキスト ドキュメントが肯定的か否定的かを評価する。
   - **名前付きエンティティの認識 (NER)**
      - 事前に定義されている複数のカテゴリ グループに分類する。
   - **個人を特定できる情報 (PII) と健康に関する情報 (PHI) の検出**
      - 機密性の高い情報を識別、分類、編集する。
   - **テスト要約**
      - 抽出テキストの要約処理を使用して、ドキュメントと会話の文字起こしの要約を生成する。
   - **エンティティ リンク設定**
      - 非構造化テキスト内にある主な概念を評価し、それらをリストとして返す。
   - **Text Analytics for Health**
      - 医師のメモ、退院要約、臨床ドキュメント、電子健康記録などの非構造化テキストから関連する医療情報を抽出してラベル付けする。
   - **カスタム テキスト分類**
      - 非構造化テキスト ドキュメントを定義したカスタム クラスに分類する。
   - **カスタム固有表現認識 (カスタム NER)**
      - 非構造化テキストを使用して、カスタム エンティティ カテゴリ (語または句のラベル) を抽出する。
   - **会話言語理解**
      - 受信した発話の全体的意図を予測し、そこから重要な情報を抽出する。
   - **質問応答**
      - 入力に対して最も適切な回答を見つける。



